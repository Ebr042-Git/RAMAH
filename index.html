<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Project Dashboard</title>
<style>
body { font-family: Arial; padding: 20px; }
.progress-bar { width: 300px; height: 25px; background: #eee; border-radius: 5px; margin-bottom: 10px; }
.progress-fill { height: 100%; background: #4caf50; border-radius: 5px; text-align: center; color: white; line-height: 25px; }
table { border-collapse: collapse; margin-top: 20px; width: 70%; }
table, th, td { border: 1px solid #444; padding: 6px; }
</style>
</head>
<body>

<h1>ðŸ“Š Project Dashboard</h1>

<label>Select Module:</label>
<select id="moduleSelect"></select>

<h2>Module Progress</h2>
<div id="progressContainer"></div>

<h2>Task Table</h2>
<div id="tableContainer"></div>

<script>
// Replace with your deployed Google Apps Script Web App URL
const API_URL = "https://script.google.com/macros/s/AKfycbzEdcuyvgbnmfYi0j4xZGu9bSj1uTDWbr9t13QTzWX_UI4Junt_HM98doudvLEhsXxQ/exec";

// Load JSON data from Google Sheet
async function loadData() {
    try {
        const response = await fetch(API_URL);
        if (!response.ok) throw new Error("Failed to fetch data");
        const data = await response.json();
        console.log("Data loaded:", data); // check data in console
        return data;
    } catch (err) {
        console.error("Error fetching data:", err);
        return [];
    }
}

// Populate module dropdown
function populateModules(data) {
    const select = document.getElementById("moduleSelect");
    const modules = Array.from(new Set(data.map(d => d.Module)));

    select.innerHTML = modules.map(m => `<option value="${m}">${m}</option>`).join("");
    select.addEventListener("change", () => renderDashboard(data));
}

// Render progress bar and task table
function renderDashboard(data) {
    const moduleName = (document.getElementById("moduleSelect")).value;
    const moduleData = data.filter(d => d.Module === moduleName);

    // Progress calculation
    const completed = moduleData.filter(d => d.Status.toLowerCase() === "done").length;
    const percent = moduleData.length === 0 ? 0 : Math.round((completed / moduleData.length) * 100);

    document.getElementById("progressContainer").innerHTML = `
        <div class="progress-bar">
            <div class="progress-fill" style="width:${percent}%">${percent}%</div>
        </div>
    `;

    // Task table
    let tableHTML = `<table>
        <tr><th>Task</th><th>Status</th><th>Assignee</th><th>Date</th></tr>`;
    moduleData.forEach(d => {
        tableHTML += `<tr>
            <td>${d.Task}</td>
            <td>${d.Status}</td>
            <td>${d.AssignedTo}</td>
            <td>${d.Date}</td>
        </tr>`;
    });
    tableHTML += `</table>`;

    document.getElementById("tableContainer").innerHTML = tableHTML;
}

// Initialize dashboard
async function init() {
    const data = await loadData();
    if (data.length === 0) {
        document.getElementById("progressContainer").innerText = "No data found.";
        return;
    }
    populateModules(data);
    renderDashboard(data);
}

init();
</script>

</body>
</html>
