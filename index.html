<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Project Management Dashboard</title>
    <style>
        body { font-family: 'Segoe UI', sans-serif; background: #f4f7f6; padding: 20px; }
        .card { background: white; border-radius: 10px; padding: 20px; margin-bottom: 30px; box-shadow: 0 4px 10px rgba(0,0,0,0.1); }
        .card h2 { color: #2980b9; border-bottom: 2px solid #eee; padding-bottom: 10px; margin-top: 0; }
        .progress-container { background: #eee; height: 15px; border-radius: 10px; margin: 15px 0; }
        .progress-fill { background: #27ae60; height: 100%; border-radius: 10px; transition: width 0.5s; }
        table { width: 100%; border-collapse: collapse; font-size: 14px; }
        th { text-align: left; color: #7f8c8d; padding: 10px; border-bottom: 1px solid #eee; }
        td { padding: 10px; border-bottom: 1px solid #f9f9f9; }
        .btn-edit { background: #3498db; color: white; border: none; padding: 5px 10px; border-radius: 4px; cursor: pointer; }
        .btn-edit:hover { background: #2980b9; }
    </style>
</head>
<body>

    <h1>Project Dashboard (Grouped)</h1>
    <div id="dashboardContainer">Loading grouped tasks...</div>

    <script>
        const API_URL = "https://script.google.com/macros/s/AKfycbypfFruIPEsgSJMqajv28LmRidZjoFNZsm7xenU1DkRXjemjUWtmSFl3-25YteCryMF/exec";

        async function updateStatus(row, newStatus) {
            const res = await fetch(API_URL, {
                method: 'POST',
                body: JSON.stringify({ row: row, status: newStatus })
            });
            if(res.ok) alert("Status Updated!");
            loadDashboard();
        }

        async function loadDashboard() {
            const response = await fetch(API_URL);
            const data = await response.json();
            
            const modules = [...new Set(data.map(d => d.Module))];
            let html = '';

            modules.forEach(mod => {
                const tasks = data.filter(d => d.Module === mod);
                const completed = tasks.filter(t => t.Status.toLowerCase() === 'done').length;
                const percent = Math.round((completed / tasks.length) * 100);

                html += `
                    <div class="card">
                        <h2>${mod}</h2>
                        <div class="progress-container">
                            <div class="progress-fill" style="width:${percent}%"></div>
                        </div>
                        <p><strong>${percent}% Complete</strong> (${completed}/${tasks.length} tasks)</p>
                        <table>
                            <tr><th>Task Description</th><th>Status</th><th>Action</th></tr>
                            ${tasks.map(t => `
                                <tr>
                                    <td>${t.Task}</td>
                                    <td>${t.Status || 'Pending'}</td>
                                    <td><button class="btn-edit" onclick="updateStatus(${t.RowIndex}, 'Done')">Mark Done</button></td>
                                </tr>
                            `).join('')}
                        </table>
                    </div>
                `;
            });
            document.getElementById('dashboardContainer').innerHTML = html;
        }

        loadDashboard();
    </script>
</body>
</html>
